{% extends "base.html" %}

{% block title %}Objects in {{ bucket_name }}{% endblock %}

{% block content %}
<h2>Objects in Bucket: {{ bucket_name }}</h2>

<!-- ÌòÑÏû¨ Ìè¥Îçî Í≤ΩÎ°ú ÌëúÏãú -->
{% if prefix %}
<p>Current Path: <strong>{{ prefix }}</strong></p>
{% endif %}

<!-- ÏóÖÎ°úÎìú Î≤ÑÌäº -->
<form action="{{ url_for('upload_file', bucket_name=bucket_name) }}" method="get">
  <button type="submit" class="btn btn-primary">Upload File</button>
</form>

<table class="table mt-3">
  <thead>
    <tr>
      <th>Name</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <!-- Î∂ÄÎ™® Ìè¥ÎçîÎ°ú Ïù¥Îèô Î≤ÑÌäº -->
    {% if prefix %}
    <tr>
      <td>
        <a href="{{ url_for('list_objects', bucket_name=bucket_name, prefix=parent_prefix) }}"><strong>‚¨ÜÔ∏è Go Up</strong></a>
      </td>
      <td></td>
    </tr>
    {% endif %}

    <!-- Ìè¥Îçî Î™©Î°ù -->
    {% for folder in folders %}
    <tr>
      <td>
        <a href="{{ url_for('list_objects', bucket_name=bucket_name, prefix=folder) }}"><strong>üìÅ {{ folder.split('/')[-2] }}</strong></a>
      </td>
      <td></td>
    </tr>
    {% endfor %}

    <!-- ÌååÏùº Î™©Î°ù -->
    {% for obj in objects %}
    <tr>
      <td>{{ obj.Key.split('/')[-1] }}</td>
      <td>
        <!-- Îã§Ïö¥Î°úÎìú Î≤ÑÌäº -->
        <a href="{{ url_for('download_file', bucket_name=bucket_name, object_key=obj.Key) }}" class="btn btn-success btn-sm">Download</a>

        <!-- ÏÇ≠Ï†ú Î≤ÑÌäº -->
        <form action="{{ url_for('delete_file', bucket_name=bucket_name, object_key=obj.Key) }}" method="post" style="display:inline;">
          <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete {{ obj.Key }}?');">Delete</button>
        </form>
      </td>
    </tr>
    {% endfor %}

    {% if not folders and not objects %}
    <tr>
      <td colspan="2" class="text-center">No objects found in this bucket.</td>
    </tr>
    {% endif %}
  </tbody>
</table>

<!-- Î£®Ìä∏Î°ú ÎèåÏïÑÍ∞ÄÍ∏∞ Î≤ÑÌäº -->
{% if prefix %}
<a href="{{ url_for('list_objects', bucket_name=bucket_name) }}" class="btn btn-secondary">Back to Root</a>
{% endif %}

<a href="{{ url_for('list_buckets') }}" class="btn btn-secondary">Back to Buckets</a>
{% endblock %}
